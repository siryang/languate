import os
import urllib

## not pretty good implement

def my_popen(cmd):
	fp = os.popen(cmd)
	info = fp.readlines()
	fp.close()
	return info

def parsePingResult(info):
	# lines = info.split(",")
	for line in info[::-1]:
		line = line.strip()
		if line.startswith("Packets") and line.endswith(r"(0% loss),"):
			return True
	return False

def ping(url):
	info = my_popen("ping -n 4 " + url)
	result = parsePingResult(info)
	#print url, result
	if result is True:
		return True

def ping2(url):
	print "start..."

	try:
		h = urllib.urlopen(url)
	except Exception, e:
		psss
	else:
		print url, h.getcode()
	finally:
		h.close()

	print "end..."


def getEnableUrl(urlList):
	print "start..."
	available = str()
	for url in urlList:
		if ping(url) is True:
			available += url + "|"

	print available

	print "end..."

def main():

	google_ip_list = '''218.253.0.174|218.253.0.80|218.253.0.81|218.253.0.181|218.253.0.154|218.253.0.91|\
	218.253.0.148|218.253.0.82|218.189.25.159|210.61.221.172|218.253.0.86|218.253.0.87|218.253.0.152|218.253.0.89|\
	218.253.0.88|218.189.25.174|218.253.0.144|203.66.124.167|218.253.0.159|203.66.124.231|218.253.0.84|218.189.25.181|\
	210.61.221.114|203.66.124.241|210.61.221.113|202.39.143.93|210.61.221.182|202.39.143.104|61.219.131.113|61.219.131.94|\
	61.219.131.118|61.219.131.89|202.39.143.98|61.219.131.103|218.253.0.187|61.219.131.237|218.253.0.163|61.219.131.212|\
	203.66.124.153|203.66.124.237|61.219.131.109|203.66.124.178|203.66.124.251|210.61.221.119|203.66.124.222|203.66.124.172|\
	203.66.124.152|203.66.124.163|218.253.0.170|203.66.124.168|210.61.221.177|203.66.124.162|210.61.221.123|202.39.143.35|\
	203.66.124.177|103.25.178.42|103.25.178.19|103.25.178.27|103.25.178.30|203.66.124.148|218.176.242.20|203.66.124.173|\
	218.176.242.118|218.176.242.109|218.176.242.168|218.189.25.167|203.116.165.187|203.66.124.236|218.176.242.103|\
	218.176.242.119|218.189.25.153|203.116.165.231|218.253.0.185|218.176.242.88|218.189.25.166|203.66.124.217|202.39.143.119|\
	218.176.242.178|218.176.242.158|218.176.242.39|203.66.124.226|203.66.124.232|218.189.25.160|61.219.131.222|218.176.242.30|\
	218.176.242.251|203.66.124.227|118.174.25.109|218.176.242.157|203.66.124.247|218.253.0.85|218.176.242.29|210.61.221.94|218.176.242.148|218.176.242.108|202.39.143.109|203.116.165.153|203.116.165.251|93.123.23.18|203.66.124.158|1.179.250.88|203.66.124.187|203.66.124.157|103.25.178.38|218.189.25.180|203.116.165.173|203.211.0.55|218.253.0.177|203.211.0.44|203.211.0.20|178.45.251.123|178.45.251.113|1.179.251.246|203.116.165.148|203.211.0.59|203.211.0.24|203.211.0.25|93.123.23.24|203.116.165.152|123.205.251.80|203.66.124.246|218.253.0.176|202.39.143.55|218.176.242.98|203.117.34.187|203.117.34.148|62.197.198.240|61.219.131.108|123.205.251.112|62.197.198.227|210.61.221.168|61.219.131.226|202.39.143.123|60.199.175.117|218.253.0.165|218.253.0.90|123.205.250.80|62.201.216.212|202.39.143.113|210.61.221.183|203.66.124.221|61.219.131.251|218.253.0.155|61.219.131.88|203.66.124.216|218.176.242.173|61.219.131.98|202.39.143.89|203.66.124.183|61.219.131.104|203.66.124.212|203.66.124.182|218.189.25.146|61.219.131.114|210.61.221.173|210.61.221.157|210.61.221.158|202.39.143.30|61.219.131.236|202.39.143.29|202.39.143.39|210.61.221.109|202.39.143.108|202.39.143.20|61.219.131.84|61.219.131.93|210.61.221.178|210.61.221.104|202.39.143.84|61.219.131.123|210.61.221.103|202.39.143.88|210.61.221.153|61.219.131.247|210.61.221.108|210.61.221.163|210.61.221.99|61.219.131.241|210.61.221.88|210.61.221.84|61.219.131.232|61.219.131.99|210.61.221.89|210.61.221.167|210.61.221.152|210.61.221.187|202.39.143.114|61.219.131.119|202.39.143.59|210.61.221.162|210.61.221.98|210.61.221.148'''

	google_ip_list = google_ip_list.split("|")

	#ping("www.baidu.com")
	ping2("http://www.baidu.com")
	ping2("https://218.176.242.251")

	#getEnableUrl(google_ip_list)

if __name__ == '__main__':
 	main() 


